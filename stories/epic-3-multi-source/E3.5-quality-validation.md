# E3.5: Data Quality Validation

**Epic:** E3 - Multi-Source Integration
**Story ID:** E3.5
**Story Points:** 3
**Priority:** P1 (High)
**Type:** Feature
**Status:** âœ… Completed

---

## User Story

**As a** developer
**I want to** flag low-quality events
**So that** users can filter or deprioritize incomplete data

---

## Acceptance Criteria

- [x] Define quality score algorithm (0-100)
  - Required fields present (+20 each): title, date, description
  - Optional fields present (+10 each): venue, age_range, price
  - Description length > 50 chars (+10)
- [x] Add `quality_score` field to normalized events
- [x] Log quality statistics (avg score, % low-quality events)
- [x] Option to filter events below quality threshold
- [x] Unit test scoring algorithm

---

## Quality Tiers

- **High:** 80-100 (complete metadata)
- **Medium:** 50-79 (missing some fields)
- **Low:** 0-49 (minimal data, consider excluding)

---

## Dependencies

**Depends on:** E3.3 (Deduplication)
**Blocks:** Epic 5 (Slash Command - needs quality filtering)

---

## Definition of Done

- [x] Quality score calculated for all events
- [x] Low-quality events flagged in logs
- [x] Can filter by minimum quality score
- [x] Unit tests pass
- [x] Statistics logged per scraping run

---

## Implementation Summary

**Files Modified:**
- `src/config.py` - Added `MIN_QUALITY_SCORE` configuration (default: 0)
- `src/processors/normalizer.py` - Enhanced quality validation
  - Added `min_quality_score` parameter to `normalize()` method
  - Implemented `_log_quality_stats()` for detailed quality reporting
  - Quality filtering with configurable threshold
  - Statistics logging (avg score, high/medium/low percentages)
- `src/orchestrator.py` - Integrated quality filtering
  - Added `min_quality_score` parameter to `fetch_events()` and `_fetch_single_source()`
  - Quality filtering for both cached and fresh events
  - Enhanced CLI with `--min-quality` flag
- `tests/test_normalizer.py` - Comprehensive quality validation tests
  - Quality score calculation tests
  - Quality filtering tests
  - Quality tier categorization tests
  - Statistics logging tests

**Quality Scoring Algorithm (0-100):**
- Title (required): +20 points
- Event date (required): +20 points
- Description: +20 points (+10 bonus if > 50 chars)
- Venue: +10 points
- Age range: +10 points
- Price: +10 points

**Quality Tiers:**
- High (80-100): Complete metadata
- Medium (50-79): Missing some fields
- Low (0-49): Minimal data

**New Features:**
- Quality score automatically calculated for all normalized events
- Configurable minimum quality threshold (via `MIN_QUALITY_SCORE` env var or `--min-quality` CLI flag)
- Detailed quality statistics logging per scraping run
- Quality filtering at normalization and orchestration levels

**Example Output:**
```
[INFO] Quality Stats: Avg=72, High=65%, Med=30%, Low=5%
[WARN] 12 events below quality threshold (score < 50)
[INFO] Normalized 230 events (0 validation errors, 12 filtered by quality)
```

**Test Coverage:**
- Quality score calculation accuracy
- Quality filtering functionality
- Quality tier categorization
- Statistics logging

---

## Technical Notes

Quality scoring is integrated into the normalizer (E2.3), with filtering and reporting capabilities added in this story.

Example log output:
```
[INFO] Quality stats: Avg=72, High=65%, Med=30%, Low=5%
[WARN] 12 events below quality threshold (score < 50)
```

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
**Completed:** 2025-10-07
