# E3.2: County Calendar Scraper

**Epic:** E3 - Multi-Source Integration
**Story ID:** E3.2
**Story Points:** 5
**Priority:** P1 (High)
**Type:** Feature
**Status:** âœ… Complete

---

## User Story

**As a** developer
**I want to** scrape events from Nevada County government calendar
**So that** I can aggregate a third source

---

## Acceptance Criteria

- [x] Implement `src/scrapers/county.py` with `CountyScraper` class
- [x] Inherit from `BaseScraper` abstract class
- [x] Check for iCal export option (use `icalendar` library if available)
- [x] Fallback to HTML scraping if no iCal
- [x] Extract same fields as other scrapers
- [x] Set `source_name = 'county'`
- [x] Return normalized event dictionaries
- [x] Unit test with sample data
- [x] Document scraping approach

---

## Investigation Tasks

1. Locate county calendar URL
2. Check for iCal/RSS export links
3. Scrape sample (iCal preferred, HTML fallback)
4. Assess kid-relevance filter needs

---

## Priority Order

iCal > RSS > HTML (in order of implementation ease)

---

## Dependencies

**Depends on:** E2.6 (Orchestrator)
**Blocks:** E3.3 (Deduplication), E3.4 (Parallel Scraping)

---

## Definition of Done

- [x] County scraper returns 20+ events
- [x] Fields match other scrapers
- [x] Unit test passes
- [x] Can run: `python -m src.orchestrator --source county`
- [x] Documentation explains scraping method

---

## Technical Notes

**Format:** Unknown (investigate iCal vs HTML)
**Expected:** Lower kid-relevance (government/senior events mixed in)

Use findings from E1.3 (Evaluate County) to inform implementation. May need extra filtering for kid-relevant content.

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
**Completed:** 2025-10-07

---

## Dev Agent Record

### Implementation Summary
- Implemented `CountyScraper` using iCal export (preferred method) with HTML fallback
- iCal parser extracts: SUMMARY, DESCRIPTION, LOCATION, DTSTART, UID, URL
- Falls back to HTML scraping of CivicEngage calendar buttons if iCal unavailable
- All county events marked as free (is_free=True)
- Successfully integrated with EventOrchestrator

### Files Changed
- `src/scrapers/county.py` - New CountyScraper with iCal + HTML support
- `src/scrapers/__init__.py` - Export CountyScraper
- `src/orchestrator.py` - Add county to AVAILABLE_SOURCES
- `tests/test_county_scraper.py` - 6 unit tests
- `data/samples/county_sample.ics` - Test fixture (iCal format)

### Test Results
- 6/6 county scraper tests passing
- 45/45 total project tests passing
- Test coverage: iCal parsing, field extraction, date parsing, mixed event types

### Scraping Method
iCal export (preferred) from https://www.nevadacountyca.gov/icalendar.aspx with HTML fallback to calendar page. Simple regex-based iCal parser for VEVENT blocks - no external icalendar library needed.
