# E3.3: Cross-Source Deduplication

**Epic:** E3 - Multi-Source Integration
**Story ID:** E3.3
**Story Points:** 5
**Priority:** P1 (High)
**Type:** Feature
**Status:** âœ… Completed

---

## User Story

**As a** developer
**I want to** detect duplicate events across sources
**So that** users don't see the same event multiple times

---

## Acceptance Criteria

- [x] Implement `src/processors/deduplicator.py` with `Deduplicator` class
- [x] Method: `deduplicate(events_list) -> deduplicated_events_list`
- [x] Strategy 1: Exact match on `content_hash`
- [x] Strategy 2: Fuzzy match on title similarity + date proximity
  - Use Levenshtein distance or similar (consider `python-Levenshtein`)
  - Threshold: 85% title similarity + same date = duplicate
- [x] When duplicates found:
  - Keep event from prioritized source (KNCO > Library > County)
  - Merge metadata (take non-null values from all duplicates)
  - Log deduplication action
- [x] Return deduplicated list with metadata count
- [x] Unit test with synthetic duplicates (exact and fuzzy)

---

## Example Scenario

**Input:**
- KNCO: "Story Time at Library" (2025-10-15, venue=null)
- Library: "Storytime @ Main Branch" (2025-10-15, venue="Main Library")

**Output:**
- "Story Time at Library" (2025-10-15, venue="Main Library") [merged]

---

## Dependencies

**Depends on:** E3.1 (Library Scraper), E3.2 (County Scraper)
**Blocks:** E3.5 (Quality Validation)

---

## Definition of Done

- [x] Deduplication detects exact matches (content_hash)
- [x] Fuzzy matching catches similar titles
- [x] Source priority respected
- [x] Metadata merged from duplicates
- [x] Unit tests pass with test cases
- [x] <5% duplicates in real combined results

---

## Technical Notes

May need to add `python-Levenshtein>=0.21.1` to requirements.txt for fuzzy matching.

Logging should show:
- Number of duplicates found
- Which events were merged
- Final deduplicated count

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
**Completed:** 2025-10-07
