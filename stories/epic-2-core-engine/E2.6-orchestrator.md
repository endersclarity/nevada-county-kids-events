# E2.6: Orchestrator (Single Source)

**Epic:** E2 - Core Scraping Engine
**Story ID:** E2.6
**Story Points:** 3
**Priority:** P0 (Critical)
**Type:** Feature
**Status:** âœ… Complete

---

## User Story

**As a** developer
**I want to** coordinate scraping, normalization, and storage
**So that** I have end-to-end working prototype

---

## Acceptance Criteria

- [x] Implement `src/orchestrator.py` with `EventOrchestrator` class
- [x] Method: `fetch_events(sources=['knco'], use_cache=True)`
  - Get scraper instance for each source
  - Use cache manager to get/fetch events
  - Normalize events
  - Return combined list
- [x] CLI interface: `python -m src.orchestrator --source knco`
- [x] Log execution summary (sources, events found, cache hits, duration)
- [x] Handle scraper errors gracefully (log, continue)
- [x] Integration test: Full pipeline, verify DB contains events

---

## CLI Example

```bash
$ python -m src.orchestrator --source knco
[INFO] Fetching events from: knco
[INFO] Cache MISS for knco, scraping...
[INFO] Scraped 200 events from KNCO
[INFO] Normalized 200 events (0 validation errors)
[INFO] Upserted 200 events to database
[SUCCESS] Total: 200 events (execution time: 3.2s)
```

---

## Dependencies

**Depends on:**
- E2.2 (KNCO Scraper)
- E2.3 (Normalizer)
- E2.4 (Supabase Integration)
- E2.5 (Cache Layer)

**Blocks:** Epic 3 (Multi-Source), Epic 4 (Delivery)

---

## Definition of Done

- [x] CLI script runs without errors
- [x] 200+ events in Supabase after run
- [x] Second run shows cache HIT
- [x] Integration test passes
- [x] Execution completes in <10 seconds

---

## Technical Notes

This is the **MVP milestone** for Epic 2. When this story is complete, you have a working single-source scraper that:
- Fetches data
- Stores in DB
- Uses caching
- Runs via command line

Ready to expand to multiple sources in Epic 3.

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
**Completed:** 2025-10-07

---

## Dev Agent Record

### Completion Notes
- Implemented EventOrchestrator with full pipeline coordination
- CLI interface with --source and --no-cache options
- fetch_events() method supports cache control and multiple sources
- Comprehensive logging with execution summary (events, cache hits, errors, duration)
- Error handling with graceful degradation (continues on scraper failure)
- All 5 integration tests passing (45 total tests across entire project)
- Context manager support for automatic resource cleanup
- Ready for production use with KNCO source
