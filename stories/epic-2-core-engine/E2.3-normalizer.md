# E2.3: Data Normalizer

**Epic:** E2 - Core Scraping Engine
**Story ID:** E2.3
**Story Points:** 3
**Priority:** P0 (Critical)
**Type:** Feature
**Status:** âœ… Complete

---

## User Story

**As a** developer
**I want to** transform scraper output into standardized schema
**So that** events from different sources are consistent

---

## Acceptance Criteria

- [x] Implement `src/processors/normalizer.py`
- [x] Define `NormalizedEvent` dataclass (matches DB schema)
- [x] Validate required fields (title, event_date, source_name)
- [x] Parse date strings to `datetime` objects (handle ISO 8601, other formats)
- [x] Generate `content_hash` (MD5 of title+date+description)
- [x] Set default values for missing optional fields (`None`)
- [x] Calculate `quality_score` (0-100 based on completeness)
- [x] Log validation errors (missing required fields)
- [x] Return list of `NormalizedEvent` objects
- [x] Unit test with various input formats

---

## Content Hash Algorithm

```python
import hashlib

def generate_content_hash(event):
    content = f"{event['title']}|{event['event_date']}|{event['description'][:200]}"
    return hashlib.md5(content.encode()).hexdigest()
```

---

## Quality Score Calculation

```python
score = 0
score += 20 if event.title else 0
score += 20 if event.event_date else 0
score += 20 if event.description else 0
score += 10 if event.venue else 0
score += 10 if event.age_range else 0
score += 10 if event.price else 0
score += 10 if len(event.description) > 50 else 0
# Max: 100
```

---

## Dependencies

**Depends on:** E2.2 (KNCO Scraper)
**Blocks:** E2.6 (Orchestrator)

---

## Definition of Done

- [x] Normalizer handles all scrapers' output formats
- [x] Validation catches missing required fields
- [x] Unit tests pass with edge cases
- [x] Quality scores are reasonable
- [x] Content hashes are unique per event

---

## Technical Notes

Date parsing should handle:
- ISO 8601: `2025-10-15T10:00:00-07:00`
- Simple date: `2025-10-15`
- Other common formats as needed

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
**Completed:** 2025-10-07

---

## Dev Agent Record

### Completion Notes
- Implemented NormalizedEvent dataclass with all fields matching DB schema
- Normalizer class with comprehensive validation and error handling
- Date parsing supports multiple formats (ISO 8601, simple dates, US format)
- MD5 content hash generation for duplicate detection
- Quality score calculation (0-100) based on 6 field completeness criteria
- All 8 unit tests passing with edge cases covered
- Logging for validation errors and statistics
