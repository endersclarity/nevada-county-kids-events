# E2.3: Data Normalizer

**Epic:** E2 - Core Scraping Engine
**Story ID:** E2.3
**Story Points:** 3
**Priority:** P0 (Critical)
**Type:** Feature
**Status:** ⏸️ Blocked

---

## User Story

**As a** developer
**I want to** transform scraper output into standardized schema
**So that** events from different sources are consistent

---

## Acceptance Criteria

- [ ] Implement `src/processors/normalizer.py`
- [ ] Define `NormalizedEvent` dataclass (matches DB schema)
- [ ] Validate required fields (title, event_date, source_name)
- [ ] Parse date strings to `datetime` objects (handle ISO 8601, other formats)
- [ ] Generate `content_hash` (MD5 of title+date+description)
- [ ] Set default values for missing optional fields (`None`)
- [ ] Calculate `quality_score` (0-100 based on completeness)
- [ ] Log validation errors (missing required fields)
- [ ] Return list of `NormalizedEvent` objects
- [ ] Unit test with various input formats

---

## Content Hash Algorithm

```python
import hashlib

def generate_content_hash(event):
    content = f"{event['title']}|{event['event_date']}|{event['description'][:200]}"
    return hashlib.md5(content.encode()).hexdigest()
```

---

## Quality Score Calculation

```python
score = 0
score += 20 if event.title else 0
score += 20 if event.event_date else 0
score += 20 if event.description else 0
score += 10 if event.venue else 0
score += 10 if event.age_range else 0
score += 10 if event.price else 0
score += 10 if len(event.description) > 50 else 0
# Max: 100
```

---

## Dependencies

**Depends on:** E2.2 (KNCO Scraper)
**Blocks:** E2.6 (Orchestrator)

---

## Definition of Done

- [ ] Normalizer handles all scrapers' output formats
- [ ] Validation catches missing required fields
- [ ] Unit tests pass with edge cases
- [ ] Quality scores are reasonable
- [ ] Content hashes are unique per event

---

## Technical Notes

Date parsing should handle:
- ISO 8601: `2025-10-15T10:00:00-07:00`
- Simple date: `2025-10-15`
- Other common formats as needed

---

**Created:** 2025-10-07
**Last Updated:** 2025-10-07
